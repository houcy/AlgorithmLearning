# 01背包问题

## 问题描述

有n个物品，它们有各自的体积和价值，现有给定容量的背包，如何让背包里装入的物品具有最大的价值总和？

为方便讲解和理解，下面讲述的例子均先用具体的数字代入，即： eg：number＝4，capacity＝8

i(物品编号)|1|2|3|4
-|-|-|-|-
w(体积)|2|3|4|5
v(价值)|3|4|5|6

## 总体思路

根据动态规划解题步骤（**问题抽象化、建立模型、寻找约束条件、判断是否满足最优性原理、找大问题与小问题的递推关系式、填表、寻找解组成**）找出01背包问题的最优解以及解组成，然后编写代码实现

## 背包问题的解决

在解决问题之前，为描述方便，首先定义一些变量：

* Vi表示第 i 个物品的价值
* Wi表示第 i 个物品的体积
* 定义V(i,j)：当前背包容量 j，前 i 个物品最佳组合对应的价值
* 同时背包问题抽象化（X1，X2，…，Xn，其中 Xi 取0或1，表示第 i 个物品选或不选）

### 解决过程

1. 建立模型，即求`max(V1X1 + V2X2 + … + VnXn)`；

2. 寻找约束条件，`W1X1 + W2X2 + … + WnXn < capacity`；

3. 寻找递推关系式，面对当前商品有两种可能性：

* 包的容量比该商品体积小，装不下，此时的价值与前`i-1`个的价值是一样的，即`V(i, j) = V(i - 1, j)`；
* 还有足够的容量可以装该商品，但装了也不一定达到当前最优价值，所以在装与不装之间选择最优的一个，即`V(i,j) = max｛V(i - 1, j)，V(i - 1, j - w(i)) + v(i)｝`<br>
其中`V(i - 1, j)`表示不装，`V(i - 1, j - w(i)) + v(i)` 表示装了第`i`个商品，背包容量减少`w(i)`，但价值增加了`v(i)`；

由此可以得出递推关系式：

* `j < w(i)      V(i, j) = V(i-1,j)`
* `j >= w(i)     V(i,j) = max｛V(i - 1, j)，V(i - 1, j - w(i)) + v(i)｝`
这里需要解释一下，为什么能装的情况下，需要这样求解（这才是本问题的关键所在！）：

可以这么理解，如果要到达`V(i, j)`这一个状态有几种方式？

肯定是两种

* 第一种是第i件商品没有装进去
* 第二种是第i件商品装进去了

没有装进去很好理解，就是`V(i - 1, j)`；装进去了怎么理解呢？如果装进去第i件商品，那么装入之前是什么状态，肯定是`V(i - 1, j - w(i))`。由于最优性原理（上文讲到），`V(i - 1, j - w(i))`就是前面决策造成的一种状态，后面的决策就要构成最优策略。两种情况进行比较，得出最优。

4. 填表，首先初始化边界条件，`V(0, j) = V(i, 0) = 0`；

i/j|0|1|2|3|4|5|6|7|8
-|-|-|-|-|-|-|-|-|-
0|0|0|0|0|0|0|0|0|0
1|0
2|0
3|0
4|0

然后一行一行的填表：

* 如 `i = 1，j = 1，w(1) = 2，v(1) = 3`， 有 `j < w(1)`，故`V(1, 1) = V(1 - 1, 1) = 0`；
* 又如 `i = 1，j = 2，w(1) = 2，v(1) = 3`，有 `j = w(1)`,故`V(1, 2) = max｛V(1 - 1, 2)，V(1 - 1, 2 - w(1)) + v(1)｝= max｛0, 0 + 3｝= 3`；
* 如此下去，填到最后一个，`i = 4，j = 8，w(4) = 5，v(4) = 6`，有`j > w(4)`，故`V(4, 8) = max｛V(4 - 1, 8)，V(4 - 1, 8 - w(4)) + v(4)｝= max｛9, 4 + 6｝= 10 ……`

填完以后表格如下:

i/j|0|1|2|3|4|5|6|7|8
-|-|-|-|-|-|-|-|-|-
0|0|0|0|0|0|0|0|0|0
1|0|0|3|3|3|3|3|3|3
2|0|0|3|4|4|7|7|7|7
3|0|0|3|4|5|7|8|9|9
4|0|0|3|4|5|7|8|9|10

5、表格填完，最优解即是`V(number, capacity) = V(4, 8) = 10`


### 后记

1. 01背包问题本质上是**穷举背包容量和可供选择的物品**(意思是里面的物品可能会放进背包，可能不会放进背包)，取得最优解，只不过在穷举的过程中，会根据状态转移方程，**只计算可能获得的最优解的部分，不去计算不是最优解的部分**。
具体来看，解题思路是把该问题分解为一个一个的小问题，一步步的通过小问题的最优解，最终得到大问题的最优解，就是动态规划的方法。<br>
比如第一个小问题是“当我的背包承重M=1，只有编号为a的物品可供选择时，最优解是什么”，然后下一个小问题是建立在前一个小问题的基础上“当我的背包承重M=1，有编号为a,b的物品可供选择时，最优解是什么”，以此类推。

2. 为什么能列出状态转移方程？是因为**每个状态的最优解，都是根据之前的状态的最优解获得的**。具体到背包问题，有以下几点：
    1. 当物品备选情况（物品备选情况指：可供选择的物品的集合）一致时，背包容量 M 越大，那么 sum_v 一定大于等于原来的值。
    2. 背包容量 M 确定时，可供选择的物品 N 越多，那么sum_v 一定大于等于原来的值。
    3. 由 1 和 2 可得，sum_v 的最大值就是当 M 和 N 取到最大值时的 sum_v
    4. 从思路上说，01背包问题有两个维度：背包容量 M，和供选择物品数 N。仔细想想，如果不借助计算机，你该如何解决这个问题？答案是，例如考虑 `M = 1` 时，先考虑a能否放入背包，取得最大值，再考虑a和b能否放入背包（a和b都是备选，最终放入背包的可能是a，可能是b，也可能是ab），这时因此与之前只考虑a的情况相比，多了一个b，所以：
        * 要先判断b能否单独放进背包：
            - 如果不能，那么备选为a,b时最大值，等于备选只有a时的最大值（因为b是放不进背包的。
            - 如果能，即b能够放进去，还有两种可能（即将b放进背包，和不将b放进背包），对这两种可能性，要取最大值：
                - 最终将b放进去(注：此时物品a是否被放进背包是未知的，原因是：剩余的背包容量可能不足以放进物品a，即要在剩余可选物品里找出最优解。
                - 最终没有将b放进去（因为后面可能有比b更合适的物品放进去），此时最大值等于备选只有a时的最大值
